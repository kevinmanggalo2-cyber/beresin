<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#24A4FF">
    <meta name="description" content="Beresin - Aplikasi Layanan Kebersihan Profesional">
    <title>Beresin - Solusi Bersih Profesional</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="assets/192.png"><link>
    <title>beresin</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #24A4FF;
            --primary-dark: #1d8ce0;
            --primary-light: #e3f2fd;
            --bg-color: #F8F9FA;
            --card-bg: #FFFFFF;
            --text-main: #1A1A1A;
            --text-sub: #757575;
            --border-color: #dee2e6;
            --danger-color: #FF4D4D;
            --success-color: #28a745;
        }

        [data-theme="dark"] {
            --bg-color: #121212;
            --card-bg: #1E1E1E;
            --text-main: #FFFFFF;
            --text-sub: #B0B0B0;
            --border-color: #333333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            overflow-x: hidden;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding-bottom: 80px;
        }

        /* Splash Screen */
        #splashScreen {
            position: fixed; inset: 0; background: var(--primary-color);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 10000; color: white; transition: 0.8s ease;
        }
        .splash-logo { font-size: 3.5rem; font-weight: 800; letter-spacing: -2px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* Navigation */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0; background: var(--card-bg);
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05); display: flex; justify-content: space-around;
            padding: 10px 0 15px 0; z-index: 1000; border-top: 1px solid var(--border-color);
        }
        .nav-item { text-align: center; color: var(--text-sub); cursor: pointer; text-decoration: none; flex: 1; transition: 0.3s; }
        .nav-item.active { color: var(--primary-color); }
        .nav-item i { font-size: 1.5rem; display: block; margin-bottom: 2px; transition: 0.3s; }
        .nav-item.active i { transform: translateY(-3px); }
        .nav-item span { font-size: 0.65rem; font-weight: 600; }

        /* Page Content */
        .page-content { display: none; min-height: 100vh; }
        .page-content.active { display: block; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Components */
        .banner-slider { position: relative; width: 50%; height: 200px; border-radius: 24px; overflow: hidden; margin-left: auto; margin-right: auto; margin-top: 1rem;margin-bottom: 1rem; box-shadow: 0 10px 25px rgba(36,164,255,0.2); }
        .banner-slide { position: absolute; inset: 0; opacity: 0; transition: 0.8s; background-size: cover; background-position: center; background-repeat: no-repeat;}
        .banner-slide.active { opacity: 1; }

        /* Voucher System */
        .voucher-section { padding: 0 1rem; margin-bottom: 1.5rem; }
        .voucher-container { display: flex; overflow-x: auto; gap: 12px; padding: 10px 0; scrollbar-width: none; }
        .voucher-container::-webkit-scrollbar { display: none; }
        .voucher-card {
            min-width: 160px; background: linear-gradient(135deg, #24A4FF, #9FD7FF);
            color: white; padding: 15px; border-radius: 18px; border: none;
            position: relative; overflow: hidden;
        }
        .voucher-card.blue { background: linear-gradient(135deg, #24A4FF, #9FD7FF); }
        .voucher-card h6 { font-weight: 800; margin-bottom: 2px; }
        .voucher-card small { font-size: 0.7rem; opacity: 0.9; }

        /* Grid */
        .service-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 0 1rem 1rem 1rem; }
        .service-item {
            text-align: center; padding: 18px 10px; background: var(--card-bg); border-radius: 22px;
            border: 1px solid var(--border-color); cursor: pointer; transition: 0.3s;
        }
        .service-item:active { transform: scale(0.9); background: var(--primary-light); }
        .service-item i { font-size: 2.2rem; color: var(--primary-color); margin-bottom: 8px; display: block; }
        .service-item small { font-weight: 700; font-size: 0.75rem; color: var(--text-main); }

        /* Worker Cards */
        .worker-card {
            background: var(--card-bg); border-radius: 24px; padding: 16px; margin-bottom: 15px;
            border: 1px solid var(--border-color); display: flex; align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.02); transition: 0.3s;
        }
        .worker-img { width: 80px; height: 80px; border-radius: 20px; object-fit: cover; margin-right: 18px; border: 3px solid var(--primary-light); }
        .worker-info h6 { font-weight: 700; margin-bottom: 3px; font-size: 1rem; }
        
        /* Chatbot UI */
        #chatbot-trigger { position: fixed; bottom: 90px; right: 20px; width: 60px; height: 60px; background: var(--primary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.8rem; box-shadow: 0 8px 25px rgba(36,164,255,0.4); z-index: 999; cursor: pointer; }
        #chatbot-window { position: fixed; bottom: 160px; right: 20px; width: 320px; height: 450px; background: var(--card-bg); border-radius: 25px; box-shadow: 0 15px 40px rgba(0,0,0,0.2); z-index: 10001; display: none; flex-direction: column; overflow: hidden; border: 1px solid var(--border-color); }
        .chat-header { background: var(--primary-color); color: white; padding: 18px; font-weight: 700; display: flex; justify-content: space-between; align-items: center; }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: #fcfcfc; }
        .chat-bubble { padding: 10px 14px; border-radius: 18px; max-width: 85%; font-size: 0.85rem; line-height: 1.4; }
        .chat-bubble.bot { background: #E9ECEF; color: #333; border-bottom-left-radius: 4px; align-self: flex-start; }
        .chat-bubble.user { background: var(--primary-color); color: white; border-bottom-right-radius: 4px; align-self: flex-end; }
        .chat-footer { padding: 12px; display: flex; gap: 8px; background: var(--card-bg); border-top: 1px solid var(--border-color); }

        /* Modals */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 10005; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .modal-overlay.active { display: flex; }
        .modal-content-custom { background: var(--card-bg); border-radius: 35px; padding: 30px; width: 92%; max-width: 450px; max-height: 85vh; overflow-y: auto; }

        .alert-custom { position: fixed; top: 25px; left: 50%; transform: translateX(-50%); z-index: 10010; border-radius: 50px; padding: 12px 30px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); font-weight: 700; }
        .form-control-custom { background: #F1F3F5; border: none; border-radius: 15px; padding: 14px 18px; font-weight: 500; }
        .badge-net { background: var(--primary-light); color: var(--primary-color); font-size: 0.7rem; padding: 5px 10px; border-radius: 8px; font-weight: 800; display: inline-block; margin-top: 5px; }
    </style>
</head>
<body>

    <div id="splashScreen">
        <div class="splash-logo">beresin</div>
        <div class="spinner-border text-light mt-4" style="width: 3rem; height: 3rem;"></div>
    </div>

    <div id="loginPage" class="page-content active">
        <div class="p-4 d-flex align-items-center justify-content-center" style="min-height: 100vh; background: var(--primary-color);">
            <div class="bg-white p-4 rounded-5 shadow-lg w-100" style="max-width: 400px;">
                <h2 class="text-center fw-bold text-primary mb-4" id="lang-login-title">Masuk</h2>
                <form id="loginForm">
                    <div class="mb-3">
                        <label class="small fw-bold mb-1">Email</label>
                        <input type="email" id="loginEmail" class="form-control form-control-custom" placeholder="Masukkan email..." required>
                    </div>
                    <div class="mb-4">
                        <label class="small fw-bold mb-1">Password</label>
                        <input type="password" id="loginPass" class="form-control form-control-custom" placeholder="Masukkan password..." required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 fw-bold py-3 rounded-4 shadow">Masuk Sekarang</button>
                    <p class="text-center mt-3 small" id="lang-no-acc">Belum punya akun? <a href="#" onclick="navigateTo('register')" class="fw-bold text-decoration-none">Daftar Akun</a></p>
                </form>
            </div>
        </div>
    </div>

    <div id="registerPage" class="page-content">
        <div class="p-4 d-flex align-items-center justify-content-center" style="min-height: 100vh; background: var(--primary-color);">
            <div class="bg-white p-4 rounded-5 shadow-lg w-100" style="max-width: 400px;">
                <h3 class="text-center fw-bold text-primary mb-3" id="lang-reg-title">Daftar Akun Baru</h3>
                <form id="regForm">
                    <div class="mb-2"><input type="text" id="regName" class="form-control form-control-custom" placeholder="Nama Lengkap" required></div>
                    <div class="mb-2"><input type="tel" id="regPhone" class="form-control form-control-custom" placeholder="Nomor WhatsApp" required></div>
                    <div class="mb-2"><textarea id="regAddress" class="form-control form-control-custom" placeholder="Alamat Lengkap Rumah" rows="2" required></textarea></div>
                    <div class="mb-2"><input type="email" id="regEmail" class="form-control form-control-custom" placeholder="Alamat Email" required></div>
                    <div class="mb-3"><input type="password" id="regPass" class="form-control form-control-custom" placeholder="Kata Sandi (Password)" required></div>
                    <button type="submit" class="btn btn-primary w-100 fw-bold py-3 rounded-4 shadow">Daftar Sekarang</button>
                    <p class="text-center mt-3 small" id="lang-have-acc">Sudah ada akun? <a href="#" onclick="navigateTo('login')" class="fw-bold text-decoration-none">Masuk</a></p>
                </form>
            </div>
        </div>
    </div>

    <div id="appContainer" style="display:none;">
        
        <div id="homePage" class="page-content">
            <div class="p-3 d-flex justify-content-between align-items-center bg-white sticky-top shadow-sm">
                <div class="p-3 d-flex align-items-center gap-2">
                    <img src="assets/512.png" alt="beresin logo" style="width: 40px; height: 40px; object-fit: contain;">
                    <h4 class="fw-bold m-0 text-primary">beresin</h4>
                    <small id="userNameDisplay" class="text-muted"></small></div>
                <div class="d-flex gap-2">
                </div>
                <div>
                    <i class="bi bi-bell-fill text-primary fs-4"></i>
                </div>
            </div>
            
            <div class="banner-slider" id="bannerSlider">
               <div class="banner-slide active" style="background-image: url('assets/slideiklanvoucher.png');"></div>
               <div class="banner-slide active" style="background-image: url('assets/sliderumahkinclong.jpg');"></div>
            </div>

            <div class="voucher-section">
                <h6 class="fw-bold mb-2">Pusat Voucher Promo</h6>
                <div class="voucher-container">
                    <div class="voucher-card"><h6>BERSIH5</h6><small>Diskon 5%</small></div>
                    <div class="voucher-card blue"><h6>HEMAT10</h6><small>Potongan 10rb</small></div>
                    <div class="voucher-card"><h6>NEWUSER</h6><small>Khusus Member</small></div>
                    <div class="voucher-card blue"><h6>CASHBACK</h6><small>Koin Beresin</small></div>
                    <div class="voucher-card"><h6>Kinclong</h6><small>Spesial Toilet</small></div>
                </div>
            </div>

            <div class="service-grid">
                <div class="service-item" onclick="openService('Deep Clean', 100000, false)"><i class="bi bi-house-heart"></i><small id="lang-deep">Deep Clean</small></div>
                <div class="service-item" onclick="openService('Sapu Pel', 40000, false)"><i class="bi bi-broom"></i><small id="lang-sweep">Sapu Pel</small></div>
                <div class="service-item" onclick="openService('Toilet', 60000, false)"><i class="bi bi-droplet"></i><small id="lang-toilet">Toilet</small></div>
                <div class="service-item" onclick="openService('Laundry', 50000, false)"><i class="bi bi-basket"></i><small id="lang-laundry">Laundry</small></div>
                <div class="service-item" onclick="openService('Setrika', 35000, false)"><i class="bi bi-steam"></i><small id="lang-iron">Setrika</small></div>
                <div class="service-item" onclick="navigateTo('categoryOthers')"><i class="bi bi-grid-fill"></i><small id="lang-others">Lainnya</small></div>
            </div>

            <div class="px-3 pb-3">
                <h6 class="fw-bold mb-3" id="lang-tips-title">Tips Kebersihan</h6>
                <div class="card p-3 border-0 shadow-sm rounded-4 mb-2">
                    <h6 class="m-0 fw-bold" style="font-size: 0.9rem;">Wastafel Mengkilap</h6>
                    <p class="small text-muted m-0">Gosok dengan kulit jeruk nipis dan garam untuk hasil maksimal.</p>
                </div>
            </div>
        </div>

        <div id="categoryOthersPage" class="page-content">
            <div class="p-3 bg-white border-bottom sticky-top shadow-sm"><button class="btn btn-sm btn-light rounded-pill px-3" onclick="navigateTo('home')"><i class="bi bi-arrow-left"></i> Kembali</button><h5 class="fw-bold mt-2">Spesialis Lainnya</h5></div>
            <div class="service-grid">
                <div class="service-item" onclick="openService('Cuci AC', 75000, false)"><i class="bi bi-wind"></i><small>Cuci AC</small></div>
                <div class="service-item" onclick="openService('Taman', 80000, false)"><i class="bi bi-tree"></i><small>Taman</small></div>
                <div class="service-item" onclick="openService('Fogging', 120000, false)"><i class="bi bi-bug"></i><small>Fogging</small></div>
            </div>
        </div>

        <div id="servicePage" class="page-content">
            <div class="p-3 bg-white border-bottom sticky-top shadow-sm"><button class="btn btn-sm btn-light rounded-pill px-3" onclick="navigateTo('home')">Kembali</button><h5 id="selectedServiceTitle" class="fw-bold mt-2">Pilih Petugas Kami</h5></div>
            <div id="workerList" class="p-3"></div>
        </div>

        <div id="packagePage" class="page-content">
            <div class="p-3 bg-white shadow-sm border-bottom sticky-top"><h5 class="fw-bold m-0" id="lang-pack-title">5 Paket Bundling Hemat</h5></div>
            <div class="p-3">
                <div class="card p-3 mb-3 border-0 shadow-sm rounded-4 d-flex flex-row justify-content-between align-items-center" onclick="openService('Deep Clean + Laundry', 120000, true)" style="cursor:pointer">
                    <div class="text-start"><h6>Deep Clean + Laundry</h6><span class="badge-net">Hemat 30rb (Harga Net)</span></div><span class="text-primary fw-bold">Rp 120k</span>
                </div>
                <div class="card p-3 mb-3 border-0 shadow-sm rounded-4 d-flex flex-row justify-content-between align-items-center" onclick="openService('Setrika + Sapu Pel', 60000, true)" style="cursor:pointer">
                    <div class="text-start"><h6>Setrika + Sapu Pel</h6><span class="badge-net">Hemat 15rb (Harga Net)</span></div><span class="text-primary fw-bold">Rp 60k</span>
                </div>
                <div class="card p-3 mb-3 border-0 shadow-sm rounded-4 d-flex flex-row justify-content-between align-items-center" onclick="openService('Cuci AC + Toilet', 110000, true)" style="cursor:pointer">
                    <div class="text-start"><h6>Cuci AC + Toilet</h6><span class="badge-net">Hemat 25rb (Harga Net)</span></div><span class="text-primary fw-bold">Rp 110k</span>
                </div>
                <div class="card p-3 mb-3 border-0 shadow-sm rounded-4 d-flex flex-row justify-content-between align-items-center" onclick="openService('Dapur + Kamar Mandi', 100000, true)" style="cursor:pointer">
                    <div class="text-start"><h6>Dapur + Kamar Mandi</h6><span class="badge-net">Hemat 20rb (Harga Net)</span></div><span class="text-primary fw-bold">Rp 100k</span>
                </div>
                <div class="card p-3 mb-3 border-0 shadow-sm rounded-4 d-flex flex-row justify-content-between align-items-center" onclick="openService('Full House Clean', 250000, true)" style="cursor:pointer">
                    <div class="text-start"><h6>Full House Clean</h6><span class="badge-net">Hemat 100rb (Harga Net)</span></div><span class="text-primary fw-bold">Rp 250k</span>
                </div>
            </div>
        </div>

        <div id="transactionPage" class="page-content">
            <div class="p-3 bg-white shadow-sm border-bottom sticky-top"><h5 class="fw-bold m-0" id="lang-trans-title">Riwayat Pesanan</h5></div>
            <div id="transList" class="p-3"></div>
        </div>

        <div id="profilePage" class="page-content">
            <div class="p-3 border-bottom bg-white shadow-sm sticky-top"><h5 class="fw-bold m-0" id="lang-profile-title">Akun Saya</h5></div>
            <div class="p-4 text-center">
                <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center shadow-lg" style="width: 80px; height: 80px;"><i class="bi bi-person-circle fs-1"></i></div>
                <h5 id="profileNameDisplay" class="fw-bold mt-2 m-0">User</h5>
                <small id="profilePhoneDisplay" class="text-muted d-block mb-4"></small>
                
                <div class="list-group text-start shadow-sm rounded-4 overflow-hidden border-0">
                    <button class="list-group-item list-group-item-action py-3 border-0" onclick="navigateTo('editProfile')"><i class="bi bi-pencil-square me-3 text-primary"></i> <span id="lang-edit-prof">Ubah Profil</span></button>
                    <button class="list-group-item list-group-item-action py-3 border-0" onclick="navigateTo('address')"><i class="bi bi-geo-alt-fill me-3 text-primary"></i> <span id="lang-addr-me">Alamat Saya</span></button>
                    <button class="list-group-item list-group-item-action py-3 border-0" onclick="navigateTo('settings')"><i class="bi bi-gear-fill me-3 text-primary"></i> <span id="lang-settings">Pengaturan</span></button>
                    <button class="list-group-item list-group-item-action py-3 border-0" onclick="navigateTo('help')"><i class="bi bi-headset-fill me-3 text-primary"></i> <span id="lang-help">Bantuan & Hubungi CS</span></button>
                    <button class="list-group-item list-group-item-action py-3 border-0 text-danger" onclick="handleLogout()"><i class="bi bi-box-arrow-right me-3"></i> <span id="lang-logout">Keluar</span></button>
                </div>
            </div>
        </div>

        <div id="addressPage" class="page-content">
            <div class="p-3 bg-white border-bottom shadow-sm"><button class="btn btn-sm btn-light rounded-pill px-3" onclick="navigateTo('profile')">Kembali</button><h5 class="fw-bold mt-2">Daftar Alamat</h5></div>
            <div class="p-3"><div id="addressList"></div><div class="mt-3"><label class="small fw-bold">Tambah Alamat Baru</label><textarea id="newAddrInput" class="form-control form-control-custom mb-2" rows="2" placeholder="Masukkan alamat..."></textarea><button class="btn btn-primary w-100 rounded-pill py-2" onclick="saveNewAddress()">Simpan</button></div></div>
        </div>

        <div id="settingsPage" class="page-content">
            <div class="p-3 bg-white border-bottom shadow-sm"><button class="btn btn-sm btn-light rounded-pill px-3" onclick="navigateTo('profile')">Kembali</button><h5 class="fw-bold mt-2">Pengaturan</h5></div>
            <div class="p-3">
                <div class="card p-3 mb-3 border-0 shadow-sm rounded-4">
                    <h6>Pilih Bahasa / Language</h6>
                    <div class="d-flex justify-content-between mb-2"><span>Indonesia</span><input type="radio" name="lang" id="langId" onchange="changeLang('id')"></div>
                    <div class="d-flex justify-content-between"><span>English</span><input type="radio" name="lang" id="langEn" onchange="changeLang('en')"></div>
                </div>
                <div class="card p-3 border-0 shadow-sm rounded-4">Mode Gelap (Dark Mode) <div class="form-check form-switch float-end"><input class="form-check-input" type="checkbox" id="themeSwitch" onchange="toggleTheme()"></div></div>
            </div>
        </div>

        <div id="editProfilePage" class="page-content">
            <div class="p-3 bg-white border-bottom shadow-sm"><button class="btn btn-sm btn-light rounded-pill px-3" onclick="navigateTo('profile')">Kembali</button><h5 class="fw-bold mt-2">Ubah Data Profil</h5></div>
            <div class="p-3"><form id="editForm"><label class="small fw-bold">Nama</label><input type="text" id="editName" class="form-control form-control-custom mb-2"><label class="small fw-bold">WhatsApp</label><input type="tel" id="editPhone" class="form-control form-control-custom mb-3"><button type="submit" class="btn btn-primary w-100 fw-bold py-2 rounded-3">Simpan Perubahan</button></form></div>
        </div>

        <div id="helpPage" class="page-content">
            <div class="p-3 bg-white border-bottom shadow-sm"><button class="btn btn-sm btn-light rounded-pill px-3" onclick="navigateTo('profile')">Kembali</button><h5 class="fw-bold mt-2">Hubungi CS</h5></div>
            <div class="p-3">
                <a href="https://wa.me/628123456789" class="card p-3 mb-3 border-0 shadow-sm rounded-4 text-decoration-none d-flex align-items-center"><i class="bi bi-whatsapp fs-2 text-success me-3"></i><div><h6 class="m-0 fw-bold text-dark">WhatsApp Admin</h6><small class="text-muted">Aktif 24 Jam</small></div></a>
                <a href="mailto:support@beresin.id" class="card p-3 mb-3 border-0 shadow-sm rounded-4 text-decoration-none d-flex align-items-center"><i class="bi bi-envelope fs-2 text-primary me-3"></i><div><h6 class="m-0 fw-bold text-dark">Email Support</h6><small class="text-muted">Layanan Teknis</small></div></a>
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" id="nav-home" onclick="navigateTo('home')"><i class="bi bi-house-door-fill"></i><span>Beranda</span></div>
            <div class="nav-item" id="nav-package" onclick="navigateTo('package')"><i class="bi bi-box-seam-fill"></i><span>Paket</span></div>
            <div class="nav-item" id="nav-transaction" onclick="navigateTo('transaction')"><i class="bi bi-receipt-cutoff"></i><span>Pesanan</span></div>
            <div class="nav-item" id="nav-profile" onclick="navigateTo('profile')"><i class="bi bi-person-fill"></i><span>Profil</span></div>
        </div>
    </div>

    <div id="chatbot-trigger" onclick="toggleChat()"><i class="bi bi-chat-dots-fill"></i></div>
    <div id="chatbot-window">
        <div class="chat-header"><span>Beresin Bot</span><i class="bi bi-x-lg" onclick="toggleChat()" style="cursor:pointer"></i></div>
        <div class="chat-body" id="chatContent">
            <div class="chat-bubble bot">Halo! Saya asisten Beresin. Ada yang bisa saya bantu terkait layanan kami?</div>
        </div>
        <div class="chat-footer">
            <input type="text" id="chatInput" class="form-control rounded-pill border-0 bg-light" placeholder="Ketik bantuan...">
            <button class="btn btn-primary rounded-circle" onclick="sendChat()"><i class="bi bi-send"></i></button>
        </div>
    </div>

    <div class="modal-overlay" id="bookingModal">
        <div class="modal-content-custom shadow-lg">
            <div class="d-flex justify-content-between mb-3"><h5 class="fw-bold m-0">Checkout</h5><button class="btn-close" onclick="closeModal('bookingModal')"></button></div>
            <div id="workerDetail" class="mb-3 p-3 bg-light rounded-4 small"></div>
            
            <div class="mb-3"><label class="small fw-bold">Jadwal Kedatangan</label><div class="d-flex gap-2 mt-1"><input type="date" class="form-control rounded-3" id="bookDate"><input type="time" class="form-control rounded-3" id="bookTime"></div></div>
            
            <div class="mb-3"><label class="small fw-bold">Alamat Pengerjaan</label><textarea class="form-control rounded-3 border-0 bg-light mt-1" id="bookAddressManual" rows="2" placeholder="Ketik alamat lengkap..."></textarea></div>

            <div class="mb-3" id="promoSection"><label class="small fw-bold text-primary">Voucher Diskon (5%)</label><select class="form-select rounded-3 mt-1" id="bookPromo" onchange="updateTotalDisplay()"><option value="0">Tanpa Voucher</option><option value="0.05">BERSIH5</option></select></div>
            <div id="bundlingNotice" class="alert alert-info py-2 small d-none">Paket bundling harga net (Voucher tidak berlaku).</div>
            
            <div class="d-flex justify-content-between fw-bold mb-4 border-top pt-3"><span>Total:</span><span class="text-primary fs-5" id="totalPriceDisplay"></span></div>
            <button class="btn btn-primary w-100 py-3 rounded-pill fw-bold shadow-lg" onclick="confirmOrder()">BAYAR SEKARANG</button>
        </div>
    </div>

    <div class="modal-overlay" id="ratingModal">
        <div class="modal-content-custom text-center shadow-lg">
            <h5 class="fw-bold">Rating Petugas</h5>
            <div class="my-4"><i class="bi bi-star rating-star" onclick="setRating(1)"></i><i class="bi bi-star rating-star" onclick="setRating(2)"></i><i class="bi bi-star rating-star" onclick="setRating(3)"></i><i class="bi bi-star rating-star" onclick="setRating(4)"></i><i class="bi bi-star rating-star" onclick="setRating(5)"></i></div>
            <textarea class="form-control mb-3 rounded-4" id="ratingComment" placeholder="Ketik ulasan Anda..." rows="3"></textarea>
            <button class="btn btn-primary w-100 py-3 rounded-pill fw-bold" onclick="submitRating()">Kirim Ulasan</button>
        </div>
    </div>

    <script>
        let transData = JSON.parse(localStorage.getItem('trans')) || [];
        let addresses = JSON.parse(localStorage.getItem('addrs')) || [];
        let currentTheme = localStorage.getItem('theme') || 'light';
        let currentLang = localStorage.getItem('lang') || 'id';

        const workers = [
            { id: 1, name: "Andi Pratama", wa: "0812-3344-5566", rating: 4.9, photo: "assets/pembantu1.jpg", review: "Sangat teliti & rapi kerjanya." },
            { id: 2, name: "Budi Santosa", wa: "0877-1122-3344", rating: 4.8, photo: "assets/pembantu2.jpg", review: "Sangat jujur dan sopan." },
            { id: 3, name: "Rizky Maulana", wa: "0812-3344-4477", rating: 4.5, photo: "assets/pembantu11.jpg", review: "Sangat kompeten dan telaten." },
            { id: 4, name: "Agus Firmansyah", wa: "0812-3344-9876", rating: 4.6, photo: "assets/pembantu12.jpg", review: "Kerja cepat dan rumah jadi bersih." },
            { id: 5, name: "Deni Kurniawam", wa: "0812-3344-5557", rating: 4.9, photo: "assets/pembantu13.jpg", review: "Kerja sopan dan detail." },
            { id: 6, name: "Siti Aisyah", wa: "0812-3345-5766", rating: 4.8, photo: "assets/pembantu3.jpg", review: "Teliti dan rapi sampai detail kecil." },
            { id: 7, name: "Dewi Lestari", wa: "0812-2244-5786", rating: 4.9, photo: "assets/pembantu4.jpg", review: "Kamar Mandi jadi kinclong." },
            { id: 8, name: "Nurul Hidayah", wa: "0812-3111-4326", rating: 4.8, photo: "assets/pembantu5.jpg", review: "bersih menyeluruh dan wangi." },
            { id: 9, name: "Putri Ananda", wa: "0812-3221-5746", rating: 4.9, photo: "assets/pembantu6.jpg", review: "sangat detail dan telaten." },
            { id: 10, name: "Rina Marlina", wa: "0812-3232-8966", rating: 4.7, photo: "assets/pembantu7.jpg", review: "Hasil bersih maksimal." },
            { id: 11, name: "Adi Nugraha", wa: "0881-3882-8956", rating: 4.9, photo: "assets/AdiNugraha.jpg", review: "Kerja cepat dan sangat bersih." },
            { id: 12, name: "Aldy Firmansyah", wa: "0895-3890-9966", rating: 4.7, photo: "assets/AldyFirmansyah.jpg", review: "Kerja rapi tanpa dipantau." },
            { id: 13, name: "Anisa Putri", wa: "0895-3890-9966", rating: 4.7, photo: "assets/AnisaPutri.jpg", review: "Pelayanan ramah dan sopan." },
            { id: 14, name: "Ayu Permata", wa: "0885-8950-9614", rating: 4.9, photo: "assets/AyuPermata.jpg", review: "Bersih, rapi dan wangi." },
            { id: 15, name: "Bayu Rahmadan", wa: "0895-3000-9998", rating: 4.7, photo: "assets/BayuRahmadan.jpg", review: "Rapi, secara detail dan telaten." },
            { id: 16, name: "Citra Puspita", wa: "0887-4590-7776", rating: 4.8, photo: "assets/CitraPuspita.jpg", review: "Pelayanan ramah dan rapi." },
            { id: 17, name: "Clara Wijaya", wa: "0890-4050-2309", rating: 4.9, photo: "assets/ClaraWijaya.jpg", review: "Ramah, rapi dan wangi." },
            { id: 18, name: "Dimas Saputro", wa: "0811-0000-7906", rating: 4.8, photo: "assets/DimasSaputro.jpg", review: "Teliti dan rapi." },
            { id: 19, name: "Dina Rahmawati", wa: "0880-3540-3450", rating: 4.6, photo: "assets/DinaRahmawati.jpg", review: "Sangat detail dan telaten." },
            { id: 20, name: "Elina Natalia", wa: "0895-3390-0066", rating: 4.9, photo: "assets/ElinaNatalia.jpg", review: "Sangat jujur dan sopan." },
            { id: 21, name: "Eliza Natalia", wa: "0847-5523-1411", rating: 4.8, photo: "assets/ElizaNatalia.jpg", review: "Profesional dan rapi." },
            { id: 22, name: "Fitri Handayani", wa: "0885-6532-7485", rating: 4.8, photo: "assets/FitriaHandayani", review: "Hasil sesuai ekspektasi." },
            { id: 23, name: "Haris Fadillah", wa: "0865-6932-4215", rating: 4.6, photo: "assets/HarisFadillah.jpg", review: "Cukup baik." },
            { id: 24, name: "Hendra Wijaya", wa: "0821-3652-1425", rating: 4.9, photo: "assets/HendraWijaya.jpg", review: "Deep cleaning sangat maksimal." },
            { id: 25, name: "Imam Maulana", wa: "0836-9874-2547", rating: 4.6, photo: "assets/ImamMaulana.jpg", review: "Pelayanan oke." },
            { id: 26, name: "Joko Susilo", wa: "0814-3982-4561", rating: 4.8, photo: "assets/JokoSusilo.jpg", review: "Kerja Cepat." },
            { id: 27, name: "Kirana Ayu", wa: "0880-1122-3365", rating: 4.7, photo: "assets/KiranaAyu.jpg", review: "Telaten dan ramah." },
            { id: 28, name: "Lilis Kartika", wa: "0888-5578-9999", rating: 4.9, photo: "assets/LilisKartika.jpg", review: "Deep cleaning terbaik." },
            { id: 29, name: "Lina Oktaviani", wa: "0811-5555-1478", rating: 4.7, photo: "assets/Lina Oktavinani.jpg", review: "Pelayanan sopan dan ramah." },
            { id: 30, name: "Melati Purnomo", wa: "0866-2222-8888", rating: 4.8, photo: "assets/MelatiPurnomo.jpg", review: "Sangat bersih." },
            { id: 31, name: "Mutiara Putri", wa: "0812-3232-8976", rating: 4.8, photo: "assets/MutiaraPutri.jpg", review: "Kerja Cepat." },
            { id: 32, name: "Nabila Zahra", wa: "0812-1112-8966", rating: 4.5, photo: "assets/NabilaZahra.jpg", review: "Profesional." },
            { id: 33, name: "Naufal Rizky", wa: "0812-3232-1966", rating: 4.7, photo: "assets/NaufalRizky.jpg", review: "Hasil Sesuai Ekspetasi." },
            { id: 34, name: "Nia Anggraini", wa: "0812-3232-1166", rating: 4.7, photo: "assets/NiaAnggraini.jpg", review: "Detail dan Rapi." },
            { id: 35, name: "Nur Hidayah", wa: "0811-2232-8966", rating: 4.9, photo: "assets/NurHidayah.jpg", review: "Kerja Bersih." },
            { id: 36, name: "Purwanto", wa: "0812-7777-8966", rating: 4.7, photo: "assets/Purwanto.jpg", review: "Pelayanan Sangat Baik." },
            { id: 37, name: "Rafi Akbar", wa: "0812-6666-8966", rating: 4.6, photo: "assets/RafiAkbar.jpg", review: "Cukup Rapi." },
            { id: 38, name: "Rahma Safitri", wa: "0812-7777-9999", rating: 4.7, photo: "assets/RahmaSafitri.jpg", review: "Sangat Teliti." },
            { id: 39, name: "Rina Marlina", wa: "0812-7777-7777", rating: 4.7, photo: "assets/RinaMarlina.jpg", review: "Profesional." },
            { id: 40, name: "Robi Kurniawan", wa: "0812-1234-8966", rating: 4.7, photo: "assets/RobiKurniawan.jpg", review: "Kerja Rapi." },
        ];

        let selectedService = "", currentPrice = 0, isBundling = false, ratingTargetId = null, curRateValue = 0;

        window.onload = () => {
            applySavedPreferences();
            setTimeout(() => {
                document.getElementById('splashScreen').style.opacity = '0';
                setTimeout(() => { document.getElementById('splashScreen').style.display = 'none'; navigateTo('login'); }, 500);
            }, 1500);
            initSlider();
        };

        function navigateTo(id) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
            document.getElementById(id + 'Page').classList.add('active');
            if(document.getElementById('nav-'+id)) {
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.getElementById('nav-'+id).classList.add('active');
            }
            if(id === 'transaction') renderTrans();
        }

        // AUTH
        document.getElementById('regForm').onsubmit = (e) => {
            e.preventDefault();
            let u = { name: document.getElementById('regName').value, phone: document.getElementById('regPhone').value, email: document.getElementById('regEmail').value, password: document.getElementById('regPass').value };
            addresses = [document.getElementById('regAddress').value];
            localStorage.setItem('user_data', JSON.stringify(u));
            localStorage.setItem('addrs', JSON.stringify(addresses));
            alert("Daftar Berhasil! Silakan Masuk."); navigateTo('login');
        };

        document.getElementById('loginForm').onsubmit = (e) => {
            e.preventDefault();
            let saved = JSON.parse(localStorage.getItem('user_data'));
            if(saved && document.getElementById('loginEmail').value === saved.email && document.getElementById('loginPass').value === saved.password) {
                document.getElementById('appContainer').style.display = 'block';
                updateProfileUI(); navigateTo('home');
            } else { alert("Login Gagal! Akun tidak ditemukan."); }
        };

        // CHATBOT
        function toggleChat() { let w = document.getElementById('chatbot-window'); w.style.display = (w.style.display === 'flex' ? 'none' : 'flex'); }
        function sendChat() {
            let input = document.getElementById('chatInput');
            let content = document.getElementById('chatContent');
            if(!input.value) return;
            content.innerHTML += `<div class="chat-bubble user">${input.value}</div>`;
            let val = input.value.toLowerCase();
            let res = "Maaf, saya tidak mengerti. Silakan hubungi CS via WhatsApp.";
            if(val.includes("promo")) res = "Voucher diskon 5% bisa digunakan dengan kode BERSIH5!";
            if(val.includes("harga")) res = "Harga layanan kami mulai dari Rp 35.000 per jam.";
            if(val.includes("halo")) res = "Halo! Ada yang bisa kami bantu hari ini?";
            setTimeout(() => {
                content.innerHTML += `<div class="chat-bubble bot">${res}</div>`;
                content.scrollTop = content.scrollHeight;
            }, 800);
            input.value = "";
        }

        // BOOKING
        function openService(name, price, bundling) {
            selectedService = name; currentPrice = price; isBundling = bundling;
            document.getElementById('selectedServiceTitle').innerText = name;
            const list = document.getElementById('workerList');
            list.innerHTML = workers.map(w => `
                <div class="worker-card" onclick="openBooking(${w.id})">
                    <img src="${w.photo}" class="worker-img">
                    <div class="flex-grow-1">
                        <div class="fw-bold">${w.name}</div>
                        <div class="small text-muted"><i class="bi bi-whatsapp"></i> ${w.wa}</div>
                        <div class="small text-warning"><i class="bi bi-star-fill"></i> ${w.rating} <span class="text-muted">"${w.review}"</span></div>
                        <div class="text-primary fw-bold">Rp ${price.toLocaleString()}</div>
                    </div>
                </div>`).join('');
            navigateTo('service');
        }

        function openBooking(wid) {
            const w = workers.find(x => x.id === wid);
            document.getElementById('workerDetail').innerHTML = `<b>Layanan:</b> ${selectedService}<br><b>Petugas:</b> ${w.name}<br><b>WhatsApp:</b> ${w.wa}`;
            document.getElementById('bookAddressManual').value = addresses[0] || ""; 
            document.getElementById('bookPromo').value = "0";
            if(isBundling) { document.getElementById('promoSection').classList.add('d-none'); document.getElementById('bundlingNotice').classList.remove('d-none'); }
            else { document.getElementById('promoSection').classList.remove('d-none'); document.getElementById('bundlingNotice').classList.add('d-none'); }
            updateTotalDisplay();
            document.getElementById('bookingModal').classList.add('active');
        }

        function updateTotalDisplay() {
            let promo = isBundling ? 0 : parseFloat(document.getElementById('bookPromo').value);
            let total = currentPrice * (1 - promo);
            document.getElementById('totalPriceDisplay').innerText = "Rp " + total.toLocaleString();
        }

        function confirmOrder() {
            if(!document.getElementById('bookDate').value || !document.getElementById('bookAddressManual').value) return alert("Mohon lengkapi jadwal dan alamat!");
            transData.unshift({ id: Date.now(), service: selectedService, total: document.getElementById('totalPriceDisplay').innerText, date: document.getElementById('bookDate').value, status: "Selesai", rated: false });
            localStorage.setItem('trans', JSON.stringify(transData));
            closeModal('bookingModal'); showAlert('Pesanan Berhasil!','success'); navigateTo('transaction');
        }

        function renderTrans() {
            const list = document.getElementById('transList');
            list.innerHTML = transData.length === 0 ? "<div class='text-center mt-5 text-muted'>Kosong</div>" : transData.map(t => `<div class="trans-card"><div class="d-flex justify-content-between mb-2"><strong class="text-primary">${t.service}</strong><span class="badge bg-success rounded-pill">Selesai</span></div><div class="small text-muted">${t.date}</div><div class="d-flex justify-content-between align-items-center mt-3 border-top pt-2"><strong>${t.total}</strong>${!t.rated ? `<button class="btn btn-sm btn-primary rounded-pill px-4" onclick="openRating(${t.id})">Rating</button>` : `<span class="text-success small fw-bold">Selesai</span>`}</div></div>`).join('');
        }

        // PREFERENCES
        function updateProfileUI() {
            let u = JSON.parse(localStorage.getItem('user_data'));
            if(!u) return;
            document.getElementById('userNameDisplay').innerText = "Halo, " + u.name;
            document.getElementById('profileNameDisplay').innerText = u.name;
            document.getElementById('profilePhoneDisplay').innerText = u.phone;
            document.getElementById('editName').value = u.name;
            document.getElementById('editPhone').value = u.phone;
            document.getElementById('addressList').innerHTML = addresses.map(a => `<div class="card p-3 mb-2 small shadow-sm border-0 rounded-3"><i class="bi bi-geo-alt-fill text-primary"></i> ${a}</div>`).join('');
        }

        function changeLang(l) { currentLang = l; localStorage.setItem('lang', l); applyLangStrings(); showAlert('Bahasa Diubah','primary'); }
        function applyLangStrings() {
            const s = { id: { deep: "Deep Clean", sweep: "Sapu Pel", toilet: "Toilet", pack: "Bundling", trans: "Pesanan" }, en: { deep: "Deep Clean", sweep: "Sweep", toilet: "Toilet", pack: "Bundling", trans: "Orders" } };
            const d = s[currentLang];
            if(document.getElementById('lang-deep')) {
                document.getElementById('lang-deep').innerText = d.deep; document.getElementById('lang-sweep').innerText = d.sweep;
                document.getElementById('lang-toilet').innerText = d.toilet; document.getElementById('lang-pack-title').innerText = d.pack;
            }
        }

        function toggleTheme() { currentTheme = (currentTheme === 'light' ? 'dark' : 'light'); document.body.setAttribute('data-theme', currentTheme); localStorage.setItem('theme', currentTheme); }
        function applySavedPreferences() { document.body.setAttribute('data-theme', currentTheme); if(document.getElementById('themeSwitch')) document.getElementById('themeSwitch').checked = (currentTheme === 'dark'); document.getElementById(currentLang === 'id' ? 'langId' : 'langEn').checked = true; applyLangStrings(); }
        function setRating(v) { curRateValue = v; document.querySelectorAll('.rating-star').forEach((s, i) => s.className = i < v ? 'bi bi-star-fill rating-star text-warning' : 'bi bi-star rating-star'); }
        function openRating(id) { ratingTargetId = id; curRateValue = 0; setRating(0); document.getElementById('ratingModal').classList.add('active'); }
        function submitRating() { if(curRateValue === 0) return alert("Pilih bintang!"); const idx = transData.findIndex(t => t.id === ratingTargetId); transData[idx].rated = true; localStorage.setItem('trans', JSON.stringify(transData)); closeModal('ratingModal'); renderTrans(); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function showAlert(m, t) { const a = document.createElement('div'); a.className = `alert-custom bg-${t} text-white`; a.innerText = m; document.body.appendChild(a); setTimeout(() => a.remove(), 2500); }
        function handleLogout() { localStorage.removeItem('user_data'); location.reload(); }
        function saveNewAddress() { let input = document.getElementById('newAddrInput').value; if(!input) return; addresses.unshift(input); localStorage.setItem('addrs', JSON.stringify(addresses)); updateProfileUI(); }
        function initSlider() { let cur = 0; const slides = document.querySelectorAll('.banner-slide'); setInterval(() => { if(slides.length){ slides[cur].classList.remove('active'); cur = (cur + 1) % slides.length; slides[cur].classList.add('active'); } }, 4000); }
    </script>
</body>
</html>